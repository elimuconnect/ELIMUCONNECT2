<!DOCTYPE html>
<html>
<head>
  <title>CBC Login</title>
</head>
<body>

  <h2>Login</h2>

  <input id="email" type="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button id="loginBtn">Login</button>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabase = createClient(
      "https://zcmzuetusvpmvubbjlmx.supabase.co",
      "sb_publishable_-BGJLAySaH7bQ5lBIZF9zg_eohK-xEn"
    );

    document.getElementById("loginBtn").onclick = async () => {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      const { error } = await supabase.auth.signInWithPassword({
        email,
        password
      });

      if (error) {
        alert(error.message);
        return;
      }

      const { data: { user } } = await supabase.auth.getUser();

     const { data: profile, error: profileError } = await supabase
  .from("profiles")
  .select("role")
  .eq("auth_id", user.id)
  .single();

if (profileError || !profile) {
  alert("Profile not found. Contact admin.");
  return;
}

if (profile.role === "teacher") {
  window.location.href = "teacher.html";
} else if (profile.role === "parent") {
  window.location.href = "parent.html";
} else if (profile.role === "admin") {
  window.location.href = "admin.html";
} else {
  alert("Unknown role");
}

      
    };
  </script>

</body>
</html>
